---
title: "Exploring NCCA"
metadata-files:
  - "../../_quarto.yml"
---

NLA data only sampled lake michigan 1 time per year and so were left out.

```{r loadNSetup}
source("Code/dataCleaning/readNCCA.r")
library(sf)
library(tidyverse)
siteFiles <- c("Data/Raw/NCCA/assessedSiteInfo2010.csv", "Data/Raw/NCCA/nAssessedSiteInfo2010.csv")
preFiles <- c("Data/Raw/NCCA/nca_waterchemdata.csv")
tenFiles<- c("Data/Raw/NCCA/assessedWaterChem2010.csv", "Data/Raw/NCCA/nassessedWaterChem2010.csv") 
fifteenFiles <- c("Data/Raw/NCCA/ncca_2015_water_chemistry_great_lakes-data.csv")
df <- readNCCA(siteFiles = siteFiles, preFiles = preFiles, tenFiles = tenFiles, fifteenFiles = fifteenFiles) %>%
  filter(WTBDY_NM == "Lake Michigan")

```

# Parameters
8 parameters all measured roughtly 140 times except TKN was measured 20 times.
```{r}
df %>%
  ggplot(aes(x = ANALYTE)) +
  geom_bar() 

```

# Spatial
- All values have a site, lat, and lon
```{r}
lakes <- sf::read_sf("Data/Other/ne_10m_lakes.shp")

ggplot(lakes) +
  geom_sf(fill = "lightblue") +
  coord_sf(xlim = c(-88, -85), ylim = c(41.5, 46.2)) +
  theme(panel.background = element_rect(fill = '#d0d890'),
        panel.grid = element_line(color = '#00000010')) +
  geom_jitter(data= df, aes(x = ALON_DD, y = ALAT_DD), size=  3)
```

# Temporal
```{r}
# No michigan values have same year
df %>% 
  ggplot(aes(x = Date, y = ANALYTE)) +
  geom_point()

```

# QA codes
- Need to find a key how to translate these codes?
```{r}
waterChem %>%
  select(QACODE) %>%
  drop_na(QACODE) %>%
  ggplot(aes(x = QACODE)) + 
  geom_bar()
```
# Units 
```{r}
df %>%
  distinct(ANALYTE, UNITS) %>%
  count(ANALYTE)
```

- all analytes have distinct units!!! yay


# Detection limits
- No NAs
- PQL is all NAs
- Below MDL reported as 0
- Equal to MDL reported as MDL
- 3 params have values between MDL
  - NH3 (n = 3)
    - reported as 0
  - PTL (n = 39)
    - values plotted below with MDL and MRL as vertical lines
  - SRP (n = 3) 
    - reported as 0
```{r}
waterChem %>%
  filter((RESULT < MDL) | (RESULT < MRL)) %>% 
  select(PARAMETER, RESULT, MRL, MDL) %>%
  mutate(Limit = case_when(RESULT < MDL ~ "MDL",
                          (RESULT < MRL) & (RESULT > MDL) ~ "MRL"))  %>%
  # filter(Limit == "MDL") %>% distinct()
  filter(Limit == "MRL", PARAMETER == "PTL") %>%
  ggplot(aes(x= RESULT)) +
  geom_histogram() + 
  geom_vline(aes(xintercept = MRL)) +
  geom_vline(aes(xintercept = MDL))

waterChem %>%
  filter(RESULT < MRL, RESULT > 0, RESULT > MDL) %>% 
  ggplot(aes(x = RESULT)) + 
  geom_histogram() + 
  facet_wrap(~PARAMETER, scales= "free")

waterChem %>%
  filter(RESULT < MDL) %>%
  ggplot(aes(x = RESULT)) +
  geom_histogram() +
  facet_wrap(~PARAMETER, scales = "free")
  
```




