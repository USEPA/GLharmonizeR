<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Exploring Full WQD</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="exploringGLENDA_files/libs/clipboard/clipboard.min.js"></script>
<script src="exploringGLENDA_files/libs/quarto-html/quarto.js"></script>
<script src="exploringGLENDA_files/libs/quarto-html/popper.min.js"></script>
<script src="exploringGLENDA_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="exploringGLENDA_files/libs/quarto-html/anchor.min.js"></script>
<link href="exploringGLENDA_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="exploringGLENDA_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="exploringGLENDA_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="exploringGLENDA_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="exploringGLENDA_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="exploringGLENDA_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="exploringGLENDA_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exploring Full WQD</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>I split the NA types into three categories (for sure NA’s, Unsure NA or not, Definitely not NA’s but I’ll address later). You can see with the line break in na argument. I determined missing values in each “VALUE” column with the commented out code below Dropped ANAL_CODE_ columns because they are redundant with the “Analyte” columns</p>
<section id="spatial-summary" class="level1">
<h1>Spatial summary</h1>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="exploringGLENDA_files/figure-html/samplesSpace-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Density of samples with respect to latitude and longitude</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="exploringGLENDA_files/figure-html/depths-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="time-summary" class="level2">
<h2 class="anchored" data-anchor-id="time-summary">Time summary</h2>
<div class="cell" data-tbl-cap="Range of years of sampling for each analyte colored by the proportion of zeros that were observed">
<div class="cell-output-display">
<p><img src="exploringGLENDA_files/figure-html/sampleYears-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="season-summary" class="level2">
<h2 class="anchored" data-anchor-id="season-summary">Season summary</h2>
<div class="cell" data-tbl-cap="Range of  months of sampling for each analyte colored by the proportion of zeros that were observed">
<div class="cell-output-display">
<p><img src="exploringGLENDA_files/figure-html/sampleSeason-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="time-of-day" class="level2">
<h2 class="anchored" data-anchor-id="time-of-day">Time of Day</h2>
<div class="cell" data-tbl-cap="Range of  months of sampling for each analyte colored by the proportion of zeros that were observed">
<div class="cell-output-display">
<p><img src="exploringGLENDA_files/figure-html/sampleTime-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="sampling-fraction" class="level1">
<h1>Sampling Fraction</h1>
<div class="cell" data-tbl-cap="Number of observations from each type of sampling fraction">
<div class="cell-output-display">
<p><img src="exploringGLENDA_files/figure-html/samplingFractions-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="depth-codes" class="level1">
<h1>Depth Codes</h1>
<div class="cell" data-tbl-cap="Number of observations from each  Depth (represented by color)">
<div class="cell-output-display">
<p><img src="exploringGLENDA_files/figure-html/depthCodes-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="units" class="level1">
<h1>Units</h1>
<p>Only measure with multiple units is Turbidty (FTU/NTU), they seem to follow same distribution</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="exploringGLENDA_files/figure-html/findingMultipleUnits-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">

<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> ANALYTE </th>
   <th style="text-align:left;"> UNITS </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Alkalinity, Total as CaCO3 </td>
   <td style="text-align:left;"> mg/l </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Alkalinity, Total as CaCO3 </td>
   <td style="text-align:left;"> none </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Carbon, Organic </td>
   <td style="text-align:left;"> % </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Carbon, Organic </td>
   <td style="text-align:left;"> mg/l </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Carbon, Organic </td>
   <td style="text-align:left;"> mg/g </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Conductivity </td>
   <td style="text-align:left;"> umho/cm </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Conductivity </td>
   <td style="text-align:left;"> none </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Magnesium </td>
   <td style="text-align:left;"> mg/l </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Magnesium </td>
   <td style="text-align:left;"> ug/l </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Manganese </td>
   <td style="text-align:left;"> ug/l </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Manganese </td>
   <td style="text-align:left;"> none </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Phosphorus, Orthophosphorus as P </td>
   <td style="text-align:left;"> ug/l </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Phosphorus, Orthophosphorus as P </td>
   <td style="text-align:left;"> mg/l </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Secchi Disc Transparency </td>
   <td style="text-align:left;"> m </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Secchi Disc Transparency </td>
   <td style="text-align:left;"> none </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sodium </td>
   <td style="text-align:left;"> mg/l </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sodium </td>
   <td style="text-align:left;"> ug/l </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Turbidity </td>
   <td style="text-align:left;"> NTU </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Turbidity </td>
   <td style="text-align:left;"> none </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Turbidity </td>
   <td style="text-align:left;"> FTU </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
<section id="remarks" class="level1">
<h1>Remarks</h1>
<div class="cell" data-tbl-cap="Counts for each type of remarks">
<div class="cell-output-display">
<p><img src="exploringGLENDA_files/figure-html/remarks-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="exploringGLENDA_files/figure-html/remarks-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 25
# ℹ 25 variables: YEAR &lt;int&gt;, MONTH &lt;chr&gt;, SEASON &lt;chr&gt;, LAKE &lt;chr&gt;,
#   CRUISE_ID &lt;chr&gt;, VISIT_ID &lt;chr&gt;, STATION_ID &lt;chr&gt;, STN_DEPTH_M &lt;dbl&gt;,
#   LATITUDE &lt;dbl&gt;, LONGITUDE &lt;dbl&gt;, SAMPLING_DATE &lt;date&gt;, TIME_ZONE &lt;chr&gt;,
#   SAMPLE_DEPTH_M &lt;dbl&gt;, DEPTH_CODE &lt;chr&gt;, MEDIUM &lt;chr&gt;, SAMPLE_TYPE &lt;chr&gt;,
#   QC_TYPE &lt;chr&gt;, SAMPLE_ID &lt;chr&gt;, ANALYTE &lt;chr&gt;, VALUE &lt;dbl&gt;, UNITS &lt;chr&gt;,
#   FRACTION &lt;chr&gt;, METHOD &lt;chr&gt;, RESULT_REMARK &lt;chr&gt;, REMARK_RISK &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="flag-risks" class="level1">
<h1>Flag risks</h1>
<div class="cell">
<div class="cell-output-display">

<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> REMARK_RISK </th>
   <th style="text-align:left;"> CLASS </th>
   <th style="text-align:left;"> RESULT_REMARK </th>
   <th style="text-align:left;"> DESCRIPTION </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> HIGH </td>
   <td style="text-align:left;"> QC Failed </td>
   <td style="text-align:left;"> Field Duplicate, failed </td>
   <td style="text-align:left;"> A field duplicate associated with this analysis failed the acceptance criteria. Validity of reported value may be compromised </td>
  </tr>
  <tr>
   <td style="text-align:left;"> HIGH </td>
   <td style="text-align:left;"> Other </td>
   <td style="text-align:left;"> Field Lab Anomaly </td>
   <td style="text-align:left;"> Reported value for lab measurement was inconsistent with reported value for corresponding field measurement. Validity of reported value may be compromised </td>
  </tr>
  <tr>
   <td style="text-align:left;"> HIGH </td>
   <td style="text-align:left;"> No Result Reported </td>
   <td style="text-align:left;"> No Result Reported, analysis canceled </td>
   <td style="text-align:left;"> Analysis was canceled and not performed. No result value was reported </td>
  </tr>
  <tr>
   <td style="text-align:left;"> HIGH </td>
   <td style="text-align:left;"> Contamination </td>
   <td style="text-align:left;"> Suspected Contamination, field </td>
   <td style="text-align:left;"> Contamination is suspected to have occurred during the field collection process. Validity of reported value may be compromised </td>
  </tr>
  <tr>
   <td style="text-align:left;"> HIGH </td>
   <td style="text-align:left;"> NA </td>
   <td style="text-align:left;"> Lab Duplicate, failed;Invalid </td>
   <td style="text-align:left;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:left;"> MEDIUM </td>
   <td style="text-align:left;"> QC Incomplete </td>
   <td style="text-align:left;"> Quality Control incomplete </td>
   <td style="text-align:left;"> Some quality control samples (such as duplicates or standard checks) related to the analysis were not prepared, analyzed, or reported. </td>
  </tr>
  <tr>
   <td style="text-align:left;"> MEDIUM </td>
   <td style="text-align:left;"> Other </td>
   <td style="text-align:left;"> Outlier, accross stations </td>
   <td style="text-align:left;"> Reported value was determined to be an outlier (&gt; 3 std. devs) when compared to other data values from the same project accross all station at which field samples were collected. </td>
  </tr>
  <tr>
   <td style="text-align:left;"> MEDIUM </td>
   <td style="text-align:left;"> Handling </td>
   <td style="text-align:left;"> Exceeded Holding Time </td>
   <td style="text-align:left;"> Sample or extract was held longer than the approved amount of time before analysis. Validity of reported value may be compromised </td>
  </tr>
  <tr>
   <td style="text-align:left;"> MEDIUM </td>
   <td style="text-align:left;"> NA </td>
   <td style="text-align:left;"> Quality Control incomplete;Suspected Contamination, field </td>
   <td style="text-align:left;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LOW </td>
   <td style="text-align:left;"> Limit </td>
   <td style="text-align:left;"> Method Detection Limit, less than </td>
   <td style="text-align:left;"> Analyte produced an instrument response but reported value is below the calculated method detection limit. Validity of reported value may be compromised </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LOW </td>
   <td style="text-align:left;"> Estimated Value </td>
   <td style="text-align:left;"> Estimated Value, outside limit of precision </td>
   <td style="text-align:left;"> Reported value was not within expected limits of precision and is therefore considered an estimate </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LOW </td>
   <td style="text-align:left;"> Corrected </td>
   <td style="text-align:left;"> Correction Factor, lab </td>
   <td style="text-align:left;"> Reported value was corrected by a lab performance check factor </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LOW </td>
   <td style="text-align:left;"> NA </td>
   <td style="text-align:left;"> Method Detection Limit, less than;Exceeded Holding Time </td>
   <td style="text-align:left;"> NA </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
<section id="missingness" class="level1">
<h1>Missingness</h1>
<section id="analytes" class="level2">
<h2 class="anchored" data-anchor-id="analytes">Analytes</h2>
<div class="cell">
<div class="cell-output-display">
<p><img src="exploringGLENDA_files/figure-html/MissingnessChloro-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="exploringGLENDA_files/figure-html/MissingnessChloro-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="spatial-information" class="level2">
<h2 class="anchored" data-anchor-id="spatial-information">Spatial information</h2>
<div class="cell">
<div class="cell-output-display">
<p><img src="exploringGLENDA_files/figure-html/missingCoords-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="exploringGLENDA_files/figure-html/missingCoords-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<!-- # Modeling information -->
<!-- ## Marginal correlations of selected covariates -->
<!-- ```{r ggpairs} -->
<!-- #| warning: false -->
<!-- #| fig-caption: "Pairwise correlation for selected variables" -->
<!-- #| cache: true -->
<!-- # lModel <- lm(formula = `Chlorophyll-a` ~ .- SAMPLE_ID, data= dfWide) -->
<!-- ggpairs(dfWide, columns = 2:10, progress = F) -->
<!-- ``` -->
<!-- ## RF Model -->
<!-- ```{r splittingData} -->
<!-- set.seed(222) -->
<!-- dfWide <- janitor::clean_names(dfWide) -->
<!-- ind <- sample(2, nrow(dfWide), replace = TRUE, prob = c(0.7, 0.3)) -->
<!-- train <- dfWide[ind==1,] -->
<!-- test <- dfWide[ind==2,] -->
<!-- ``` -->
<!-- ```{r randomForest} -->
<!-- #| cache: true -->
<!-- #| tbl-cap: "Prediction results on hold out data" -->
<!-- rf <- randomForest::randomForest(chlorophyll_a ~. - sample_id, data=train, proximity=TRUE, na.action = na.omit)  -->
<!-- print(rf) -->
<!-- p <- predict(rf, newdata = test) -->
<!-- caret::postResample(p, test$chlorophyll_a) %>% -->
<!--   as.data.frame() %>% -->
<!--   kable() %>% -->
<!--   kable_paper() -->
<!-- ``` -->
<!-- ## Distributions of selected covariates -->
<!-- ```{r covarDists} -->
<!-- g <- dfWide %>% -->
<!--   pivot_longer(-c(sample_id, year, season)) %>% -->
<!--   ggplot(aes(x = value)) + -->
<!--   geom_histogram() + -->
<!--   facet_wrap(~name, scales = "free") +  -->
<!--   ggtitle("linear scale") -->
<!-- g -->
<!-- g+ scale_x_log10() +ggtitle("log10 scale") -->
<!-- ``` -->
<!-- ```{r spaghetti} -->
<!-- df %>% -->
<!--   filter(ANALYTE == "Chlorophyll-a", DEPTH_CODE == "Surface") %>% -->
<!--   unite("Position", LATITUDE, LONGITUDE) %>% -->
<!--   mutate(SAMPLING_DATE = date(SAMPLING_DATE)) %>% -->
<!--   group_by(SAMPLING_DATE, Position) %>% -->
<!--   summarize(CHLA = mean(VALUE, rm.na=  T)) %>% -->
<!--   ggplot(aes(x = SAMPLING_DATE, y = CHLA, col = factor(Position))) + -->
<!--   geom_line() + -->
<!--   theme(legend.position = "none") + -->
<!--   ggtitle("Spaghetti plot of CHLA over time for each LAT/LONG, Surface samples") -->
<!-- ``` -->
<!-- # Dealing with similar/same analytes -->
<!-- | Similar Analytes                                 | How to resovlve | Reason                        | -->
<!-- |:--------------------------|:---------------------------|:----------------| -->
<!-- | Ammonia-Nitrogen / Ammonium-Nitrogen             |                 |                               | -->
<!-- | Alkalinity / Hardness                            | Drop Hardness   | Hardness has 95% missingness  | -->
<!-- | Nitrogen particulate / Nitrogen sediment         |                 |                               | -->
<!-- | Turbidity / Secchi disc / total suspended solids | Keep Turbidity  | Others have \>90% missingness | -->

<!-- | Phosphorus, Base Extractable as P" ? ???? -->
<!-- -   Phosphorus Total as P -->
<!-- -   Phsophorus particulate/ sediment -->
<!-- <!-- ```{r vizMissing} -->
<p>–&gt; <!-- <!-- dfWide %>% --> –&gt; <!-- <!--   select(contains("Hardness"), contains("Alkalinity")) %>% --> –&gt; <!-- <!--   visdat::vis_miss() --> –&gt;</p>
<!-- <!-- dfWide %>% -->
<p>–&gt; <!-- <!--   select(contains("Turbid"), contains("Secchi"), contains("suspended")) %>% --> –&gt; <!-- <!--   visdat::vis_miss() --> –&gt;</p>
<!-- <!-- ``` -->
<p>–&gt;</p>
<!-- <!-- # PCA -->
<p>–&gt;</p>
<!-- <!-- ```{r PCA} -->
<p>–&gt; <!-- <!-- dfWideNoMiss <- dfWide %>% --> –&gt; <!-- <!--   janitor::clean_names() %>% --> –&gt; <!-- <!--   mutate(lchla = log(chlorophyll_a + 0.01)) %>% --> –&gt; <!-- <!--   drop_na() --> –&gt; <!-- <!-- PCA <- dfWideNoMiss %>%  --> –&gt; <!-- <!--   select(-c(sample_id, season, year, chlorophyll_a, lchla))  %>% --> –&gt; <!-- <!--   prcomp(center = T, scale=T) --> –&gt;</p>
<!-- <!-- plot(summary(PCA)$importance[2,], xlab= "Principal component", ylab = "% variance explained") -->
<p>–&gt;</p>
<!-- <!-- autoplot(PCA, data = dfWideNoMiss, colour = "lchla", -->
<p>–&gt; <!-- <!--          loadings = TRUE, loadings.colour = 'blue', --> –&gt; <!-- <!--          loadings.label = TRUE, loadings.label.size = 3) --> –&gt; <!-- <!-- autoplot(PCA, data = dfWideNoMiss, colour = "season", --> –&gt; <!-- <!--          loadings = TRUE, loadings.colour = 'blue', --> –&gt; <!-- <!--          loadings.label = TRUE, loadings.label.size = 3) --> –&gt; <!-- <!-- autoplot(clara(dfWideNoMiss[-c(1,2,3,13)], 2)) --> –&gt; <!-- <!-- ``` --> –&gt;</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>